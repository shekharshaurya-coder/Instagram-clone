<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SocialSync ‚Äî Sign Up</title>
  <style>
    :root{
      --bg:#0f0f11;
      --panel:#151516;
      --muted:#9b9b9f;
      --accent:#7b6ef6;
      --card:#171718;
      --border:rgba(255,255,255,0.03);
      font-family: Inter, system-ui, sans-serif;
    }
    html,body{
      height:100%; margin:0;
      background: #000000;
      background-size: cover;
      color:#e9e9eb;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width:820px;
      max-width:95%;
      background:var(--card);
      border-radius:12px;
      padding:34px;
      border:1px solid var(--border);
      box-shadow:0 4px 18px rgba(0,0,0,0.6);
    }
    .card-header{margin-bottom:18px}
    .card-title{font-size:22px;font-weight:700}
    .card-sub{font-size:13px;color:var(--muted)}

    .form-wrap{display:flex;gap:40px;align-items:flex-start}
    .left-illustration{width:240px;display:flex;flex-direction:column;align-items:center;gap:12px}
    .illus-circle{width:140px;height:140px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 20% 20%, #7b6ef6,#3b2fef)}
    .illus-circle img{width:100%;height:100%;object-fit:cover}
    .illus-text{font-size:13px;color:var(--muted);text-align:center}

    .form{flex:1}
    label{display:block;font-size:13px;margin-bottom:8px;color:var(--muted)}
    input{width:100%;padding:12px 14px;background:var(--panel);border:1px solid var(--border);border-radius:8px;color:#fff;font-size:14px}
    input:focus{outline:none;border-color:var(--accent)}
    input::placeholder{color:#555}

    .form-group{margin-bottom:14px}

    .actions{display:flex;align-items:center;justify-content:space-between;margin-top:18px}
    .btn{padding:10px 16px;border-radius:10px;border:none;cursor:pointer;font-size:14px;transition:0.3s}
    .btn-primary{background:var(--accent);color:#fff;font-weight:600}
    .btn-primary:hover{background:#6a5ee5}
    .btn-primary:disabled{opacity:0.5;cursor:not-allowed}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted);text-decoration:none;display:inline-block}
    .btn-ghost:hover{border-color:var(--accent);color:var(--accent)}

    .error{color:#ff7979;margin-top:8px;font-size:13px;display:none}
    .success{color:#7bed9f;margin-top:8px;font-size:13px;display:none}
    .helper{margin-top:18px;font-size:13px;color:var(--muted)}

    .password-requirements{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      padding:10px;
      background:var(--panel);
      border-radius:6px;
      display:none;
    }
    .password-requirements.show{display:block}
    .requirement{margin:4px 0}
    .requirement.met{color:#7bed9f}

    @media(max-width:900px){
      .form-wrap{flex-direction:column}
      .left-illustration{order:2;width:100%}
    }
  </style>
</head>
<body>

  <section class="card">
    
    <div class="card-header">
      <div class="card-title">Join SocialSync</div>
      <div class="card-sub">Create your account to get started</div>
    </div>

    <div class="form-wrap">
      <div class="left-illustration">
        <div class="illus-circle">
          <img src="monkey.jpg" alt="Monkey Cartoon" style="width:100%;height:100%;object-fit:cover;">
        </div>
        <div class="illus-text">Join thousands of users sharing their thoughts and connecting with others.</div>
      </div>

      <form id="signupForm" class="form" onsubmit="return false;">
        <div class="form-group">
          <label>Email</label>
          <input id="email" type="email" required placeholder="you@domain.com">
        </div>

        <div class="form-group">
          <label>Username</label>
          <input id="username" type="text" required placeholder="johndoe" pattern="[a-zA-Z0-9_]+" title="Only letters, numbers and underscores">
        </div>

        <div class="form-group">
          <label>Password</label>
          <div style="position:relative;">
            <input id="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="padding-right:36px;">
            <span id="togglePass" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;color:var(--muted);font-size:14px;">üëÅÔ∏è</span>
          </div>
          <div class="password-requirements" id="passwordReqs">
            <div class="requirement" id="req-length">‚Ä¢ At least 6 characters</div>
          </div>
        </div>

        <div class="form-group">
          <label>Confirm Password</label>
          <input id="confirmPassword" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>

        <div class="actions">
          <button id="submitBtn" class="btn btn-primary" type="button">Create Account</button>
          <a href="/login.html" class="btn btn-ghost">Sign In</a>
        </div>

        <div id="error" class="error"></div>
        <div id="success" class="success"></div>
        <div id="loading" class="helper" style="display:none">Creating your account‚Ä¶</div>
      </form>
    </div>
  </section>

<script>
  const submitBtn = document.getElementById('submitBtn');
  const errorEl = document.getElementById('error');
  const successEl = document.getElementById('success');
  const loadingEl = document.getElementById('loading');
  const passwordInput = document.getElementById('password');
  const passwordReqs = document.getElementById('passwordReqs');

  function showError(msg) {
    errorEl.style.display = 'block';
    errorEl.textContent = msg;
    successEl.style.display = 'none';
  }

  function showSuccess(msg) {
    successEl.style.display = 'block';
    successEl.textContent = msg;
    errorEl.style.display = 'none';
  }

  function clearMessages() {
    errorEl.style.display = 'none';
    successEl.style.display = 'none';
  }

  // Password validation
  passwordInput.addEventListener('focus', () => {
    passwordReqs.classList.add('show');
  });

  passwordInput.addEventListener('input', () => {
    const password = passwordInput.value;
    const lengthReq = document.getElementById('req-length');
    
    if (password.length >= 6) {
      lengthReq.classList.add('met');
    } else {
      lengthReq.classList.remove('met');
    }
  });

  passwordInput.addEventListener('blur', () => {
    setTimeout(() => {
      passwordReqs.classList.remove('show');
    }, 200);
  });

  // Password toggle
  const togglePass = document.getElementById('togglePass');
  if (togglePass && passwordInput) {
    togglePass.addEventListener('click', () => {
      const isPwd = passwordInput.type === 'password';
      passwordInput.type = isPwd ? 'text' : 'password';
      togglePass.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
      passwordInput.focus();
    });
  }

  // Form submission
  submitBtn.addEventListener('click', async () => {
    clearMessages();

    const email = document.getElementById('email').value.trim();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    // Validation
    if (!email || !username || !password || !confirmPassword) {
      showError('All fields are required');
      return;
    }

    if (!email.includes('@')) {
      showError('Please enter a valid email');
      return;
    }

    if (username.length < 3) {
      showError('Username must be at least 3 characters');
      return;
    }

    if (!/^[a-zA-Z0-9_]+$/.test(username)) {
      showError('Username can only contain letters, numbers and underscores');
      return;
    }

    if (password.length < 6) {
      showError('Password must be at least 6 characters');
      return;
    }

    if (password !== confirmPassword) {
      showError('Passwords do not match');
      return;
    }

    loadingEl.style.display = 'block';
    submitBtn.disabled = true;

    try {
      const response = await fetch('http://localhost:3000/api/auth/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, username, password })
      });

      const data = await response.json();

      if (response.status === 201) {
        // Store token and redirect
        if (data.token) {
          localStorage.setItem('token', data.token);
        }
        
        showSuccess('Account created successfully! Redirecting...');
        
        setTimeout(() => {
          window.location.href = '/index.html';
        }, 1500);
        return;
      }

      if (response.status === 400) {
        showError(data.message || 'Username or email already taken');
        return;
      }

      showError(data.message || 'Signup failed. Please try again.');

    } catch (err) {
      console.error(err);
      showError('Network error. Please check your connection.');
    } finally {
      loadingEl.style.display = 'none';
      submitBtn.disabled = false;
    }
  });

  // Allow Enter key to submit
  document.getElementById('signupForm').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      submitBtn.click();
    }
  });
</script>

</body>
</html>